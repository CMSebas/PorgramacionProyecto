<ion-header class="top-header">
  <ion-toolbar class="top-toolbar">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="volver()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>Accesos Registrados</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="main-bg">
  <div class="card">

    <!-- FECHAS -->
    <div class="filters">
      <div class="fcol">
        <div class="flabel">Desde</div>
        <ion-item lines="none" class="date-item">
  <ion-input type="date" [(ngModel)]="desde"></ion-input>
</ion-item>
      </div>

      <div class="fcol">
        <div class="flabel">Hasta</div>
       <ion-item lines="none" class="date-item">
  <ion-input type="date" [(ngModel)]="hasta"></ion-input>
</ion-item>
      </div>
    </div>

    <ion-button expand="block" class="btn-filter" (click)="filtrar()">
      FILTRAR
    </ion-button>

    <!-- MENSAJE -->
    <div *ngIf="mensaje" class="msg">{{ mensaje }}</div>

    <!-- LOADING -->
    <div *ngIf="cargando" class="msg">Cargando...</div>

    <!-- TABLAS POR USUARIO -->
    <div *ngFor="let u of usuarios" class="user-block">
      <div class="user-title">{{ u.nombre }}</div>

      <div class="table-wrap">
        <table class="access-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Acceso Correcto</th>
              <th>Acceso Incorrecto</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let r of u.filas">
              <!-- si quieres en formato 02/03/2024 usa el pipe, si no deja r.fecha -->
              <td>{{ r.fecha | date:'dd/MM/yyyy' }}</td>
              <td class="num">{{ r.correcto }}</td>
              <td class="num">{{ r.incorrecto }}</td>
            </tr>

            <tr class="total-row">
              <td>Total:</td>
              <td class="num">{{ u.totalCorrecto }}</td>
              <td class="num">{{ u.totalIncorrecto }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- BOTON GRAFICAS (SIN LOGICA) -->
   <ion-button
  expand="block"
  (click)="abrirGraficas()"
  class="btn-graph"
  [disabled]="usuarios.length === 0"
>
  Ver Gráficas
</ion-button>

  </div>
</ion-content>

<ion-modal
  [isOpen]="modalGraficas"
  (didPresent)="onModalDidPresent()"
  (didDismiss)="cerrarGraficas()"
  class="modal-graficas"
>
  <ng-template>
    <ion-header>
      <ion-toolbar class="modal-toolbar">
        <ion-buttons slot="start">
          <ion-button fill="clear" (click)="cerrarGraficas()">
            <ion-icon name="close-circle-outline"></ion-icon>
          </ion-button>
        </ion-buttons>

        <ion-title>Gráficas de Accesos Registrados</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content class="modal-content">
      <div class="modal-card">
        <canvas #pieCanvas></canvas>
      </div>

      <div class="modal-card">
        <canvas #barCanvas></canvas>
      </div>

      <ion-button expand="block" class="btn-cerrar" (click)="cerrarGraficas()">
        Cerrar
      </ion-button>
    </ion-content>
  </ng-template>
</ion-modal>

